
<meta charset="UTF-8">
<title>订单管理</title>
<style>
	.btns {
		margin: 5px;
	}
	.btn {
		display: inline-block;/* 不占满整个父元素 */
		padding: .3em 1.2em;
		border-radius: 3px;
		/*background-color: teal;
		color: #fff;*/
		border: 1px solid #333;
		cursor: pointer;/*手型*/

	}
	.search {
		display: inline-block;不占满整个父元素
		float: right;
		border: 1px solid #333;
		border-radius: 0.3em;
		width: 200px;
		height: 30.6px;
		box-sizing: border-box;
		
	}
	table.table {
		margin-top: 15px;
		box-sizing: border-box;
		width: 100%;
		border-collapse: collapse;
	}
	table.table td ,
	table.table th {
		border: 1px solid #ccc;
		line-height: 2em;
		text-align: center;
	}

	table.table tr.current {
		background-color: #ededed;
	}

	.none {
		display: none;
	}
</style>

<script src="https://cdn.bootcss.com/jquery/3.4.1/jquery.min.js"></script>


<h3>订单管理</h3>
<div class="order">
	<div id="btns">
		<div class="btn" id="btn_add">添加订单</div>
		<div class="btn" id="btn_dels">批量删除</div>
		<div class="btn">导出</div>
		<!-- <div class="search"> -->
			<input type="text" placeholder="请输入...">
			<!-- <img src="./images/sousuo.png" alt="">
		</div> -->
	</div>
	<div class="forms">
		<form action="javascript:void(0);" class="">
			<input type="hidden" name="id">
			<table>
				<tbody>
					<tr>
						<td>顾客编号</td>
						<td><input type="text" name="customerId"></td>
						<td></td>
					</tr>
					<tr>
						<td>地址编号</td>
						<td><input type="text" name="addressId"></td>
						<td></td>
					</tr>
					<tr>
						<td>员工编号</td>
						<td><input type="password" name="waiterId"></td>
						<td></td>
					</tr>
					<tr>
						<td>总计个数</td>
						<td><input type="text" name="total"></td>
						<td></td>
					</tr>
					<tr>
						<td class="submit"><input type="submit" value="保存"></td>
					</tr>
				</tbody>
			</table>
		</form>
	</div>
	<table class="table" id="order_tbl">
		<thead>
			<tr>
				<th width="60px"><input type="checkbox"></th>
				<th>顾客编号</th>
				<th>地址编号</th>
				<th>下单时间</th>
				<th>员工编号</th>
				<th>总计个数</th>
				<th width="200px">操作</th>
			</tr>
		</thead>
		<tbody>
		<tr class="none">
			<td><input type="checkbox">1</td>
			<td>1</td>
			<td>1</td>
			<td>1</td>
			<td>1</td>
			<td>1</td>
			<td>
				<a class="btn_del" href="javascript:void(0)">删除</a>
				<a class="btn_upd" href="javascript:void(0)">修改</a>
				<a class="btn_detail" href="javascript:void(0)">详情</a>
			</td>
		</tr>
	</tbody>
	</table>
	
</div>
	<div>
		<tr></tr>
	</div>
<script>
	var baseURL = "http://134.175.154.93:6677";
	var btn_add = document.getElementById("btn_add");
	var tbody = document.getElementsByTagName("tbody")[0];

	initData();
	//初始化数据
	function initData(){
		//获取后台数据，然后将数据显示在表格中
		var url = "/order/findAllOrder";
		$.get(baseURL+url,function(response){
			//先将tbody中的数据清空
			
			$("#order_tbl > tbody").empty();//清空列表内容
			//alert(1);
			response.data.forEach(function(item){
				//alert(1);
				var newTr = $(`<tr>
				<td><input type="checkbox" value="`+item.id+`" name="check"></td>
				<td>`+item.customerId+`</td>
				<td>`+item.addressId+`</td>
				<td>`+item.orderTime+`</td>
				<td>`+item.waiterId+`</td>
				<td>`+item.total+`</td>
				<td>
					<a class="btn_del" href="javascript:void(0)">删除</a>
					<a class="btn_upd" href="javascript:void(0)">修改</a>
					<a class="btn_det" href="javascript:void(0)">详情</a>
				</td>
			</tr>`);
				$("#order_tbl > tbody").append(newTr);
				//alert(1);
			});
		});

	}

	//onclick,为添加按钮绑定事件
	btn_add.onclick = function(event){	
		document.querySelector("input[name=customerId]").value = "";
		document.querySelector("input[name=addressId]").value = "";
		document.querySelector("input[name=waiterId]").value = "";
		document.querySelector("input[name=total]").value = "";
	};

	//为保存按钮添加绑定事件
	document.forms[0].onsubmit = function(event){
		//1. 校验
		//alert(1);
		//2. 获取有效值
		var realname = document.querySelector("input[name=customerId]").value
		var telephone = document.querySelector("input[name=addressId]").value;
		var telephone = document.querySelector("input[name=waiterId]").value;
		var telephone = document.querySelector("input[name=total]").value;
		var id = document.querySelector("input[name=id]").value;
		//3. 与后台进行交互
		var url = baseURL+"/orderLine/updateOrderLinePrimaryKey";
			var data;
			if(id){
				data = "id="+id+"&customerId="+customerId+"&addressId="+addressId+"&waiterId"+waiterId+"&total"+total
			} else {
				//alert(1);
				data = "customerId="+customerId+"&addressId="+addressId+"&waiterId"+waiterId+"&total"+total
			}
			//ajax
			$.post(url,data,function(result){
				alert(result.message);
				initData();
			});
			event.preventDefault();
		}


	//为删除按钮绑定事件
	tbody.onclick = function(event){
		if(event.target.nodeName === "A") {
			switch(event.target.className){
				case "btn_del":
					//0. 获取当前的id
					var id = event.target.parentNode.parentNode.children[0].children[0].value;
					alert(id);
					var url = baseURL+"/order/deleteOrderById";
					var data = "id="+id;
					$.post(url,data,function(result){
						//alert(1);
						initData();
					})
					break;
				//为修改按钮绑定事件
				case "btn_upd":
					//alert(1);
					//1. 将原有的信息放到表单中
					var id = event.target.parentNode.parentNode.children[0].children[0].value;
					var realname = event.target.parentNode.parentNode.children[1].innerText
					var realname = event.target.parentNode.parentNode.children[2].innerText
					var telephone = event.target.parentNode.parentNode.children[4].innerText;
					var realname = event.target.parentNode.parentNode.children[5].innerText
					document.querySelector("input[name=customerId]").value = customerId;
					document.querySelector("input[name=addressId]").value = addressId;
					document.querySelector("input[name=waiterId]").value = waiterId;
					document.querySelector("input[name=total]").value = total;
					document.querySelector("input[name=id]").value = id;
					break;
				}
			}
		}
	

	//为详情按钮绑定事件

	//为批量删除按钮绑定事件

	//为光标所在行添加背景色
	tbody.onmouseover = function(event){
		//console.log(event);
		var target = event.target;
		if(target.nodeName == "TD"){
			target.parentNode.className = "current"
		}
	}
	//鼠标移出来时背景色取消
	tbody.onmouseout = function(event){
		//console.log(event);
		var target = event.target;
		if(target.nodeName == "TD"){
			target.parentNode.className = ""
		}
	}


	//分页跳转设计

</script>





